import streamlit as st
import pandas as pd
import requests
import json
import time
import pytz
from datetime import datetime, timedelta
# saju_logic ëª¨ë“ˆ í•¨ìˆ˜ ë¡œë“œ (ê°™ì€ í´ë”ì— saju_logic.pyê°€ ìˆì–´ì•¼ í•¨)
from saju_logic import analyze_user, login_user, save_consultation, get_monthly_ganji, get_db_data, check_and_init_db

# --- ì„¤ì • ---
st.set_page_config(page_title="ì²œê¸°í†µë‹¬: ëª…ë¦¬í•™ ë§ˆìŠ¤í„°", layout="wide")

# DB ì•ˆì „ì¥ì¹˜ ê°€ë™
check_and_init_db()

try: FIXED_API_KEY = st.secrets["GEMINI_API_KEY"]
except: FIXED_API_KEY = "ì—¬ê¸°ì—_API_í‚¤ë¥¼_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"

# --- ì„¸ì…˜ ì´ˆê¸°í™” ---
for k in ['chat_history', 'chat_input_manual']:
    if k not in st.session_state: st.session_state[k] = [] if k == 'chat_history' else None
if 'logged_in' not in st.session_state: st.session_state['logged_in'] = False
if 'user_name' not in st.session_state: st.session_state['user_name'] = ""
if 'run_analysis' not in st.session_state: st.session_state['run_analysis'] = False
if 'analysis_mode' not in st.session_state: st.session_state['analysis_mode'] = "lifetime"

# ==============================================================================
# [ê¸°ëŠ¥ 1] 2026ë…„ ê¸¸ì¼/í‰ì¼ ì •ë°€ ì‚°ì¶œ
# ==============================================================================
def find_best_worst_days_2026(user_day_stem, user_day_branch):
    branches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥']
    nobleman_map = {'ç”²': ['ä¸‘', 'æœª'], 'æˆŠ': ['ä¸‘', 'æœª'], 'åºš': ['ä¸‘', 'æœª'], 'ä¹™': ['å­', 'ç”³'], 'å·±': ['å­', 'ç”³'], 'ä¸™': ['äº¥', 'é…‰'], 'ä¸': ['äº¥', 'é…‰'], 'å£¬': ['å·³', 'å¯'], 'ç™¸': ['å·³', 'å¯'], 'è¾›': ['åˆ', 'å¯…']}
    yuk_hap_map = {'å­': 'ä¸‘', 'ä¸‘': 'å­', 'å¯…': 'äº¥', 'äº¥': 'å¯…', 'å¯': 'æˆŒ', 'æˆŒ': 'å¯', 'è¾°': 'é…‰', 'é…‰': 'è¾°', 'å·³': 'ç”³', 'ç”³': 'å·³', 'åˆ': 'æœª', 'æœª': 'åˆ'}
    
    my_branch_idx = branches.index(user_day_branch)
    chung_branch = branches[(my_branch_idx + 6) % 12]
    yuk_hai_map = {'å­': 'æœª', 'ä¸‘': 'åˆ', 'å¯…': 'å·³', 'å·³': 'å¯…', 'å¯': 'è¾°', 'è¾°': 'å¯', 'ç”³': 'äº¥', 'äº¥': 'ç”³', 'é…‰': 'æˆŒ', 'æˆŒ': 'é…‰', 'åˆ': 'ä¸‘', 'æœª': 'å­'}
    xing_map = {'å¯…': ['å·³', 'ç”³'], 'å·³': ['å¯…', 'ç”³'], 'ç”³': ['å¯…', 'å·³'], 'ä¸‘': ['æˆŒ', 'æœª'], 'æˆŒ': ['ä¸‘', 'æœª'], 'æœª': ['ä¸‘', 'æˆŒ'], 'å­': ['å¯'], 'å¯': ['å­'], 'è¾°': ['è¾°'], 'åˆ': ['åˆ'], 'é…‰': ['é…‰'], 'äº¥': ['äº¥']}
    
    stems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸']
    stem_idx = stems.index(user_day_stem)
    branch_idx = branches.index(user_day_branch)
    diff = (branch_idx - stem_idx)
    if diff < 0: diff += 12
    gongmang_table = {10: ['æˆŒ', 'äº¥'], 8: ['ç”³', 'é…‰'], 6: ['åˆ', 'æœª'], 4: ['è¾°', 'å·³'], 2: ['å¯…', 'å¯'], 0: ['å­', 'ä¸‘']}
    my_gongmang = gongmang_table.get(diff, [])

    found_good = []
    found_bad = []
    
    start_date = datetime(2026, 1, 1)
    for i in range(365): 
        curr = start_date + timedelta(days=i)
        row = get_db_data(curr.year, curr.month, curr.day, False)
        
        if row:
            day_ganji = row[4] 
            day_branch = day_ganji[1]
            date_str = curr.strftime("%mì›” %dì¼")
            
            # ê¸¸ì¼
            is_good = False
            reasons_good = []
            if day_branch in nobleman_map.get(user_day_stem, []): reasons_good.append("ì²œì„ê·€ì¸")
            if yuk_hap_map.get(user_day_branch) == day_branch: reasons_good.append("ìœ¡í•©")
            if reasons_good: found_good.append(f"{date_str}({day_ganji}: {','.join(reasons_good)})")

            # í‰ì¼
            is_bad = False
            reasons_bad = []
            if day_branch == chung_branch: reasons_bad.append("ì¶©")
            if day_branch in my_gongmang: reasons_bad.append("ê³µë§")
            if yuk_hai_map.get(user_day_branch) == day_branch: reasons_bad.append("ìœ¡í•´")
            if day_branch in xing_map.get(user_day_branch, []): reasons_bad.append("í˜•ì‚´")
            if reasons_bad: found_bad.append(f"{date_str}({day_ganji}: {','.join(reasons_bad)})")

    def sample_dates(date_list, count=12):
        if not date_list: return []
        if len(date_list) <= count: return date_list
        step = len(date_list) // count
        return [date_list[i] for i in range(0, len(date_list), step)][:count]

    final_good = sample_dates(found_good, 10)
    final_bad = sample_dates(found_bad, 10)
            
    return final_good, final_bad

# ==============================================================================
# [ê¸°ëŠ¥ 2] ë‚ ì§œ íŒŒì‹± â†’ DB ë°ì´í„° ë§¤í•‘ (ì˜¤ëŠ˜/ë‚´ì¼ ì²˜ë¦¬ ê°•í™”)
# ==============================================================================
def get_db_ganji_for_query(query_text):
    kst = pytz.timezone('Asia/Seoul')
    now = datetime.now(kst)
    today_str = now.strftime('%Yë…„ %mì›” %dì¼')
    
    url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key={FIXED_API_KEY}"
    headers = {'Content-Type': 'application/json'}
    
    prompt = f"""
    Current Reference Time (KST): {now.strftime('%Y-%m-%d %H:%M:%S')} (Today is {today_str})
    
    Task: Extract the TARGET date from user query: "{query_text}"
    
    Rules for Date Extraction:
    1. "ì˜¤ëŠ˜", "ê¸ˆì¼", "ì§€ê¸ˆ" -> Return {today_str} (Year: {now.year}, Month: {now.month}, Day: {now.day})
    2. "ë‚´ì¼" -> Add 1 day to Reference Time.
    3. "ëª¨ë ˆ" -> Add 2 days.
    4. If specific date is given (e.g. "5ì›” 5ì¼"), assume Current Year {now.year}.
    5. If NO date mentioned, return "found": false.

    Return JSON ONLY: {{"found": true, "year": 2026, "month": 5, "day": 3}}
    """
    
    try:
        r = requests.post(url, headers=headers, json={"contents": [{"parts": [{"text": prompt}]}]})
        content = r.json()['candidates'][0]['content']['parts'][0]['text']
        res_json = json.loads(content.replace("```json", "").replace("```", "").strip())
        
        if not res_json.get('found', False): return ""
        
        t_y, t_m, t_d = int(res_json['year']), int(res_json['month']), int(res_json['day'])
        row = get_db_data(t_y, t_m, t_d, False)
        
        if row:
            return f"""
            \n[ğŸ“… ë‚ ì§œ ì§ˆë¬¸ ê°ì§€ë¨: {t_y}.{t_m}.{t_d}]
            - ì‹œìŠ¤í…œ DB ì¡°íšŒ ê²°ê³¼(ì ˆëŒ€ê°’): ë…„ì£¼({row[2]}) / ì›”ì£¼({row[3]}) / ì¼ì£¼({row[4]})
            - ì§€ì¹¨: ìœ„ ê°„ì§€ ë°ì´í„°ë¥¼ íŒ©íŠ¸ë¡œ ì‚¬ìš©í•˜ì—¬ ìš´ì„¸ë¥¼ ì„¤ëª…í•˜ì‹œì˜¤. ì¬ê³„ì‚° ê¸ˆì§€.
            """
        else:
            return f"\n[ì‹œìŠ¤í…œ ê²½ê³ ] {t_y}ë…„ {t_m}ì›” {t_d}ì¼ DB ë°ì´í„° ì—†ìŒ."
    except: return ""

# ==============================================================================
# [ê¸°ëŠ¥ 3] â˜…â˜…â˜… íƒ€ì¸ ì‚¬ì£¼(ë‚¨í¸/ìë…€ ë“±) ìë™ ê³„ì‚° ë° ì£¼ì… (ê°•ë ¥ ê°•í™”)
# ==============================================================================
def extract_and_analyze_target(text):
    """
    ì‚¬ìš©ì ì…ë ¥ í…ìŠ¤íŠ¸ì—ì„œ 'ë‹¤ë¥¸ ì‚¬ëŒ'ì˜ ìƒë…„ì›”ì¼ì´ ë³´ì´ë©´ ì¦‰ì‹œ DBë¥¼ ëŒë ¤ ì‚¬ì£¼ë¥¼ ë½‘ì•„ëƒ…ë‹ˆë‹¤.
    """
    url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key={FIXED_API_KEY}"
    headers = {'Content-Type': 'application/json'}
    
    prompt = f"""
    Task: Extract birth info from text: "{text}"
    
    Target: Someone OTHER than the user (e.g., husband, wife, son, daughter, partner).
    If the text contains a date like "1973ë…„ 11ì›” 30ì¼" or "731130", extract it.
    
    Rules:
    - Year: 4 digits (e.g., 73 -> 1973)
    - Lunar: true if 'ìŒë ¥' mentioned, else false.
    - Time: Extract hour (0-23). If 'ì˜¤ì „ 6ì‹œ' -> 6. If unknown -> 0.
    - Gender: Guess from context (husband/son -> male, wife/daughter -> female). Default 'male'.
    - If NO birth date is present, return "found": false.
    
    Return JSON ONLY:
    {{"found": true, "relation": "ë‚¨í¸", "year": 1973, "month": 11, "day": 30, "hour": 6, "lunar": true, "gender": "ë‚¨ì„±"}}
    """
    
    try:
        r = requests.post(url, headers=headers, json={"contents": [{"parts": [{"text": prompt}]}]})
        res_json = json.loads(r.json()['candidates'][0]['content']['parts'][0]['text'].replace("```json", "").replace("```", "").strip())
        
        if res_json.get("found"):
            # ì‹œìŠ¤í…œì´ ì§ì ‘ ê³„ì‚° (analyze_user í˜¸ì¶œ)
            y, m, d = res_json['year'], res_json['month'], res_json['day']
            h = res_json.get('hour', 0)
            is_lunar = res_json.get('lunar', False)
            gender = res_json.get('gender', 'ë‚¨ì„±')
            relation = res_json.get('relation', 'ìƒëŒ€ë°©')
            
            # DB ì¡°íšŒ ë° ì‚¬ì£¼ ì‚°ì¶œ
            target_res = analyze_user(y, m, d, h, is_lunar, gender)
            
            if "error" in target_res:
                return f"\n[ì‹œìŠ¤í…œ ì•Œë¦¼] {relation}ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ë ¤ í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: {target_res['error']}"
            
            # â˜… AIì—ê²Œ ë– ë¨¹ì—¬ì¤„ ìµœì¢… ë°ì´í„° í”„ë¡¬í”„íŠ¸
            return f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[âš¡ ê¸´ê¸‰: ì œ3ì({relation}) ì‚¬ì£¼ ë°ì´í„° í™•ë³´ ì™„ë£Œ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì‹œìŠ¤í…œì´ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ë¯¸ ë§Œì„¸ë ¥ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.
AIëŠ” "ê³„ì‚° ê¸°ëŠ¥ì´ ì—†ë‹¤"ê³  ë§í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì•„ë˜ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë¶„ì„ì— ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.

1. ëŒ€ìƒ: {relation} ({gender}, {y}ë…„ {m}ì›” {d}ì¼ {h}ì‹œìƒ, {'ìŒë ¥' if is_lunar else 'ì–‘ë ¥'})
2. **ì‚¬ì£¼ ì›êµ­ (í™•ì •ê°’):** {target_res['ì‚¬ì£¼']}
3. **ëŒ€ìš´ íë¦„:** {target_res['ëŒ€ìš´']}

**[AI í–‰ë™ ì§€ì¹¨]**
- ìœ„ ì‚¬ì£¼ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚´ë‹´ì(ë³¸ì¸)ì™€ì˜ ê¶í•©ì´ë‚˜ ìƒëŒ€ë°©ì˜ ì„±í–¥ì„ ì¦‰ì‹œ ë¶„ì„í•´ ì¤„ ê²ƒ.
- ì ˆëŒ€ "ë§Œì„¸ë ¥ ì•±ì„ ì°¾ì•„ë³´ë¼"ê±°ë‚˜ "ê¸°ëŠ¥ì´ ì—†ë‹¤"ê³  ê±°ì ˆí•˜ì§€ ë§ ê²ƒ. ì´ë¯¸ ë°ì´í„°ê°€ ì—¬ê¸° ìˆìŒ.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            """
        else: 
            return ""
    except Exception as e: 
        return ""

def get_yearly_detailed_flow(year):
    flow_text = f"\n[â˜† {year}ë…„ ì›”ë³„ ìƒì„¸ íë¦„ (DB ê¸°ë°˜)]\n"
    try:
        for m in range(1, 13):
            data = get_monthly_ganji(year, m)
            if data: flow_text += f"- {m}ì›”: {data['month_ganji']} (ì„¸ìš´ {data['year_ganji']}ê³¼ì˜ ê´€ê³„)\n"
        return flow_text
    except: return ""

# ==========================================
# ë©”ì¸ UI
# ==========================================
if not st.session_state['logged_in']:
    st.title("ğŸ”’ ëª…ë¦¬í•™ ë§ˆìŠ¤í„° ë¡œê·¸ì¸")
    col1, col2, col3 = st.columns([1,1,1])
    with col2:
        with st.form("login_form"):
            username = st.text_input("ì•„ì´ë””", placeholder="test1")
            password = st.text_input("ë¹„ë°€ë²ˆí˜¸", type="password", placeholder="1234")
            if st.form_submit_button("ë¡œê·¸ì¸", type="primary"):
                user_name = login_user(username, password)
                if user_name:
                    st.session_state['logged_in'] = True
                    st.session_state['user_id'] = username
                    st.session_state['user_name'] = user_name
                    st.rerun()
                else: st.error("ë¡œê·¸ì¸ ì‹¤íŒ¨ (ID/PW í™•ì¸ ë˜ëŠ” DB ì˜¤ë¥˜)")

else:
    with st.sidebar:
        st.info(f"ğŸ“ ë§ˆìŠ¤í„°: {st.session_state['user_name']}")
        if st.button("ë¡œê·¸ì•„ì›ƒ"):
            st.session_state['logged_in'] = False
            st.session_state.clear()
            st.rerun()
        st.divider()

        st.header("ğŸ“ ë‚´ë‹´ì ì •ë³´")
        name = st.text_input("ì„±ëª…", value="í™ê¸¸ë™")
        gender = st.radio("ì„±ë³„", ["ë‚¨ì„±", "ì—¬ì„±"], horizontal=True)
        calendar_type = st.radio("ë‹¬ë ¥", ["ì–‘ë ¥", "ìŒë ¥"], horizontal=True)
        is_lunar = (calendar_type == "ìŒë ¥")
        
        c1, c2 = st.columns(2)
        # [ìˆ˜ì •] 2026ë…„ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ max_value ì¶”ê°€
        with c1: birth_date = st.date_input("ìƒë…„ì›”ì¼", value=pd.to_datetime("1980-01-01"), min_value=pd.to_datetime("1900-01-01"), max_value=pd.to_datetime("2026-12-31"))
        with c2: birth_time = st.time_input("íƒœì–´ë‚œ ì‹œê°„", value=pd.to_datetime("14:30").time())
        
        st.divider()
        st.markdown("### âš¡ ì£¼ì œë³„ ì‹¬ì¸µ ë¶„ì„")
        
        if st.button("ğŸ“… 2026ë…„ ë³‘ì˜¤ë…„ ì´ìš´ (ê¸¸ì¼/í‰ì¼ í¬í•¨)"):
            st.session_state['run_analysis'] = True
            st.session_state['analysis_mode'] = "2026_fortune"
            st.session_state['chat_history'] = []
            st.session_state.pop('lifetime_script', None)
            st.rerun()

        keywords = ["ğŸ’° ì¬ë¬¼/ì‚¬ì—… ì „ëµ", "ğŸ  ë¶€ë™ì‚°/ë§¤ë§¤ ì‹œê¸°", "â¤ï¸ ì¸ì—°/ë¶€ë¶€ ê¶í•©", "ğŸ’Š ê±´ê°•/ì²´ì§ˆ ë¶„ì„", "âš–ï¸ ê´€ì¬/ì†¡ì‚¬ ì „ëµ", "ğŸ“ í•™ì—…/ì§„ë¡œ ì ì„±", "âœˆï¸ ì´ë™/ë³€ë™ìˆ˜", "ğŸ¢ ì¡°ì§/ë¦¬ë”ì‹­ ë¶„ì„"]
        
        for kw in keywords:
            if st.button(kw):
                st.session_state['chat_input_manual'] = kw + "ì— ëŒ€í•´ ì¸í‰ëª…ë¦¬ì™€ ê¶í†µë³´ê°ì˜ ê´€ì ì—ì„œ ì •ë°€í•˜ê²Œ ë¶„ì„í•˜ê³ , êµ¬ì²´ì ì¸ ì¸ìƒ ì „ëµì„ ì œì‹œí•´ ì£¼ì‹­ì‹œì˜¤."
                st.session_state['run_analysis'] = True
                st.session_state['analysis_mode'] = "lifetime" 
                st.session_state['chat_history'] = []
                st.rerun()

        st.markdown("---")
        if st.button("ğŸ“œ ì •í†µ í‰ìƒ ì‹¬ì¸µ ë¶„ì„ (ì¼ë°˜)", type="primary"):
            st.session_state['run_analysis'] = True
            st.session_state['analysis_mode'] = "lifetime"
            st.session_state['chat_history'] = [] 
            st.session_state.pop('lifetime_script', None)
            st.rerun()

    st.title("ğŸ“œ ì •í†µ ëª…ë¦¬í•™ ë§ˆìŠ¤í„°: ì¸ìƒ ì „ëµ ë³´ê³ ì„œ")

    if st.session_state['run_analysis']:
        if not FIXED_API_KEY or len(FIXED_API_KEY) < 10:
            st.error("API í‚¤ ì˜¤ë¥˜")
            st.stop()

        url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key={FIXED_API_KEY}"
        headers = {'Content-Type': 'application/json'}

        # DB ì›êµ­ ì‚°ì¶œ
        result = analyze_user(birth_date.year, birth_date.month, birth_date.day, birth_time.hour, is_lunar, gender)
        
        if "error" in result:
            st.error(result["error"])
        else:
            current_age = datetime.now().year - birth_date.year + 1
            
            with st.expander("ğŸ“Š ì •ë°€ ëª…ì‹  ì‚°ì¶œ ê²°ê³¼", expanded=True):
                c1, c2, c3 = st.columns([1, 2, 1])
                with c1:
                    st.info(f"{name} ({gender}, {current_age}ì„¸)")
                    st.write(f"ëª…ê¶: **{result['ìë¯¸ë‘ìˆ˜']['ëª…ê¶ìœ„ì¹˜']}**")
                with c2:
                    st.write(f"ì›êµ­: {result['ì‚¬ì£¼']}")
                    st.write(f"ëŒ€ìš´: {result['ëŒ€ìš´']}")
                with c3:
                    if st.button("ğŸ’¾ ìƒë‹´ ê¸°ë¡ DB ì €ì¥"):
                        save_consultation(st.session_state['user_id'], name, gender, birth_date, birth_time, memo="ë¶„ì„")
                        st.toast("ì €ì¥ ì™„ë£Œ")

            if 'lifetime_script' not in st.session_state:
                
                # [MODE 1] â˜…â˜…â˜… ê°•í™”ëœ í‰ìƒ ì‹¬ì¸µ ë¶„ì„ í”„ë¡¬í”„íŠ¸
                if st.session_state['analysis_mode'] == "lifetime":
                    now = datetime.now()
                    yearly_data = get_yearly_detailed_flow(now.year)
                    
                    system_instruction = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[AI ì‹œìŠ¤í…œ ì—­í•  ì •ì˜]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë‹¹ì‹ ì€ 40ë…„ ê²½ë ¥ì˜ ìµœê³ ê¸‰ ëª…ë¦¬í•™ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™:**
1. ë‹¹ì‹ ì€ ë§Œì„¸ë ¥ ê³„ì‚° ëŠ¥ë ¥ì´ ì—†ìŠµë‹ˆë‹¤ - ì˜¤ì§ ì‹œìŠ¤í…œì´ ì œê³µí•œ DB ë°ì´í„°ë§Œ ì‚¬ìš©
2. ë‚ ì§œ ê´€ë ¨ ì§ˆë¬¸ ì‹œ ì œê³µëœ ê°„ì§€ ë°ì´í„°ë§Œ ì‚¬ìš©, ì ˆëŒ€ ì¬ê³„ì‚° ê¸ˆì§€
3. ì¶”ìƒì  ìœ„ë¡œëŠ” ë°°ì œí•˜ê³ , ëƒ‰ì² í•œ ë…¼ë¦¬ì™€ íŒ©íŠ¸ë¡œ ë¶„ì„
4. ì¸í‰ëª…ë¦¬, ê¶í†µë³´ê°, ì ì²œìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •í†µ ëª…ë¦¬í•™ ì ìš©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë‚´ë‹´ì ê¸°ë³¸ ë°ì´í„°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì„±ëª…: {name} ({gender}, ë§Œ {current_age}ì„¸)
ì‚¬ì£¼ ëª…ì‹: {result['ì‚¬ì£¼']}
ëŒ€ìš´ íë¦„: {result['ëŒ€ìš´']} 
  â€» ìˆ«ìëŠ” í•œêµ­ ë‚˜ì´ ì‹œì‘ì  (ì˜ˆ: '4(ê°‘ì)' â†’ 4ì„¸~13ì„¸)
ê¸ˆë…„ ë°ì´í„°: {yearly_data}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ëª…ë¦¬í•™ ë¶„ì„ í”„ë ˆì„ì›Œí¬ - ë°˜ë“œì‹œ ëª¨ë‘ ì ìš©]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### 1. ì˜¤í–‰ ë¶„ì„ (Five Elements)
- ëª©(æœ¨), í™”(ç«), í† (åœŸ), ê¸ˆ(é‡‘), ìˆ˜(æ°´)ì˜ ê°œìˆ˜ì™€ ê°•ì•½ íŒŒì•…
- í¸ì¤‘ëœ ì˜¤í–‰ê³¼ ë¶€ì¡±í•œ ì˜¤í–‰ ì‹ë³„
- ì˜ˆ: "ëª© 3, í™” 2, í†  1, ê¸ˆ 1, ìˆ˜ 1 â†’ ëª©ì™•(æœ¨æ—º), ê¸ˆìˆ˜ ë¶€ì¡±"

### 2. ìš©ì‹ ë¡  (God of Use)
- ì¼ê°„(æ—¥å¹²)ì˜ ê°•ì•½ íŒë‹¨ (ì‹ ì™•/ì‹ ì•½)
- ìš©ì‹ (ç”¨ç¥): ëª…ì‹ì„ ì¡°í™”ë¡­ê²Œ ë§Œë“œëŠ” í•µì‹¬ ì˜¤í–‰
- í¬ì‹ (å–œç¥): ìš©ì‹ ì„ ë•ëŠ” ì˜¤í–‰
- ê¸°ì‹ (å¿Œç¥): í•´ê°€ ë˜ëŠ” ì˜¤í–‰
- ì˜ˆ: "ì¼ê°„ ê°‘ëª© ì‹ ì™• â†’ ìš©ì‹ ì€ ê²½ê¸ˆ(ê´€ì„±), í¬ì‹ ì€ í† (ì¬ì„±)"

### 3. ê²©êµ­ë¡  (Pattern Analysis)
- ì •ê²©(æ­£æ ¼): ì •ê´€ê²©, ì •ì¬ê²©, ì‹ì‹ ê²©, ì •ì¸ê²© ë“±
- íŠ¹ìˆ˜ê²©: ì¢…ê²©(å¾æ ¼), í™”ê²©(åŒ–æ ¼), ì–‘ì¸ê²©(ç¾Šåˆƒæ ¼) ë“±
- ê²©êµ­ ì„±ë¦½ ì—¬ë¶€ì™€ íŒŒê²©(ç ´æ ¼) ìš”ì†Œ ë¶„ì„
- ì˜ˆ: "ì‹ì‹ ìƒì¬ê²© ì„±ë¦½, ë‹¨ ê´€ì„±ì´ ì‹ì‹ ì„ ê·¹í•˜ì—¬ íŒŒê²© ìš°ë ¤"

### 4. ìœ¡ì‹ ë¡  (Six Relations)
- ë¹„ê²(æ¯”åŠ«): í˜•ì œ, ê²½ìŸì
- ì‹ìƒ(é£Ÿå‚·): ìì‹, í‘œí˜„ë ¥, ì¬ëŠ¥
- ì¬ì„±(è²¡æ˜Ÿ): ì¬ë¬¼, ë°°ìš°ì(ë‚¨ì„±)
- ê´€ì„±(å®˜æ˜Ÿ): ì§ì¥, ëª…ì˜ˆ, ë°°ìš°ì(ì—¬ì„±)
- ì¸ì„±(å°æ˜Ÿ): í•™ë¬¸, ì–´ë¨¸ë‹ˆ, ë³´í˜¸ì

ê° ìœ¡ì‹ ì˜ ê°•ì•½ê³¼ ìœ„ì¹˜(ì—°/ì›”/ì¼/ì‹œ)ì— ë”°ë¥¸ ì˜ë¯¸ í•´ì„
ì˜ˆ: "ì›”ì§€ ì •ì¬ â†’ ë¶€ëª¨ ë•, ì¬ë¬¼ìš´ ê¸¸ìƒ"

### 5. ì‹­ì´ìš´ì„± (Twelve Life Cycles)
ì¥ìƒ(é•·ç”Ÿ), ëª©ìš•(æ²æµ´), ê´€ëŒ€(å† å¸¶), ê±´ë¡(å»ºç¥¿), ì œì™•(å¸æ—º), 
ì‡ (è¡°), ë³‘(ç—…), ì‚¬(æ­»), ë¬˜(å¢“), ì ˆ(çµ•), íƒœ(èƒ), ì–‘(é¤Š)
- ê° ê¸°ë‘¥ì˜ ì‹­ì´ìš´ì„±ì„ ë¶„ì„í•˜ì—¬ ìƒì•  íë¦„ íŒŒì•…
- ì˜ˆ: "ì¼ì§€ ì œì™• â†’ ì¤‘ë…„ ëŒ€ì„±, ì‹œì§€ ì‡  â†’ ë§Œë…„ ì‡ í‡´ ì£¼ì˜"

### 6. ì‹ ì‚´ë¡  (Spirit Stars)
- ê¸¸ì‹ : ì²œì„ê·€ì¸, ì²œë•ê·€ì¸, ì›”ë•ê·€ì¸, ë¬¸ì°½ê·€ì¸, í•™ë‹¹, ê¸ˆì—¬ë¡
- í‰ì‚´: ë„í™”ì‚´, ì—­ë§ˆì‚´, ë°±í˜¸ëŒ€ì‚´, ì–‘ì¸ì‚´, ê´´ê°•ì‚´, ê³µë§
- ê° ì‹ ì‚´ì˜ ì‘ìš©ê³¼ ì˜í–¥ë ¥ í•´ì„
- ì˜ˆ: "ì²œì„ê·€ì¸ 2ê°œ â†’ ìœ„ê¸° ì‹œ ê·€ì¸ ì¡°ë ¥, ë„í™”ì‚´ â†’ ì´ì„± ì¸ì—° ë³µì¡"

### 7. í•©ì¶©í˜•í•´íŒŒí•´ (Combinations & Clashes)
- í•©(åˆ): ì²œê°„í•©, ì§€ì§€í•©(ìœ¡í•©, ì‚¼í•©, ë°©í•©)
- ì¶©(æ²–): ì§€ì§€ì¶© (ìì˜¤ì¶©, ì¶•ë¯¸ì¶© ë“±)
- í˜•(åˆ‘): ì‚¼í˜•, ìí˜•
- í•´(å®³): ìœ¡í•´
- íŒŒ(ç ´): ì§€ì§€íŒŒ
- ê°ê°ì˜ ì‘ìš©ë ¥ê³¼ ê¸¸í‰ íŒë‹¨

### 8. ì¡°í›„ë¡  (Climate Adjustment)
- ì¶œìƒ ê³„ì ˆ(ì¶˜í•˜ì¶”ë™)ì— ë”°ë¥¸ ì˜¤í–‰ ì„ í˜¸
- í•œë‚œì¡°ìŠµ(å¯’æš–ç‡¥æ¿•) ê· í˜• í•„ìš”
- ì˜ˆ: "ë™ìƒ(å†¬ç”Ÿ) ìˆ˜ì™• â†’ í™”(ç«)ë¡œ ì¡°í›„ í•„ìˆ˜"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë¶„ì„ í”„ë¡œí† ì½œ - ë‹¨ê³„ë³„ ì‹¤í–‰]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**STEP 1. ì›êµ­ ì •ë°€ êµ¬ì¡° ë¶„ì„**
- ì¼ê°„ íŒŒì•… ë° ê°•ì•½ íŒë‹¨
- ì˜¤í–‰ ë¶„í¬ì™€ í¸ì¤‘ë„
- ê²©êµ­ ì„±ë¦½ ì—¬ë¶€
- ìš©ì‹ /í¬ì‹ /ê¸°ì‹  ì„ ì •
- ì¡°í›„ í•„ìš”ì„±

**STEP 2. ìœ¡ì‹  ë° ì‹­ì´ìš´ì„± ë¶„ì„**
- ê° ê¸°ë‘¥(ë…„/ì›”/ì¼/ì‹œ)ì˜ ìœ¡ì‹  ë°°ì¹˜
- ì‹­ì´ìš´ì„±ì„ í†µí•œ ìƒì•  ê³¡ì„  ì˜ˆì¸¡
- ì‹ ì‚´ì˜ ì˜í–¥ë ¥

**STEP 3. â˜… ê³¼ê±° ëŒ€ìš´ ê²€ì¦ (Past Verification)**
ì§€ë‚˜ì˜¨ ê° ëŒ€ìš´ì˜ ë‚˜ì´ êµ¬ê°„ì„ ì •í™•íˆ ëª…ì‹œí•˜ê³ :
- í•´ë‹¹ ëŒ€ìš´ì˜ í¬ê¸°(å–œå¿Œ) íŒë³„
- ê·¸ ì‹œê¸°ì— ë°œìƒí–ˆì„ êµ¬ì²´ì  ì‚¬ê±´ ì˜ˆì¸¡
  (í•™ì—…, ë¶€ëª¨, ì¬ë¬¼, ê±´ê°•, ê´€ì¬ìˆ˜, ì´ë™, ì¸ì—° ë“±)
- "00ì„¸~00ì„¸(00ëŒ€ìš´)ëŠ” ~~í•œ ì‹œê¸°ì˜€ìœ¼ë¯€ë¡œ ~~í•œ ì¼ì´ ìˆì—ˆì„ ê²ƒ"
- íŒ©íŠ¸ ì²´í¬í•˜ë“¯ ìƒì„¸íˆ ì„œìˆ 

**STEP 4. í˜„ì¬ ë° ë¯¸ë˜ ëŒ€ìš´ ì˜ˆì¸¡**
- í˜„ì¬ ëŒ€ìš´ì˜ ê¸¸í‰ê³¼ ì£¼ì˜ì‚¬í•­
- í–¥í›„ 10ë…„, 20ë…„ íë¦„ ì „ë§
- ì„¸ìš´(ë…„ìš´)ê³¼ì˜ ìƒí˜¸ì‘ìš©

**STEP 5. ì‹¤ì „ ì¸ìƒ ì „ëµ**
- ìš©ì‹  ê°œìš´ë²• (ì§ì—…, ë°©ìœ„, ìƒ‰ìƒ, ì´ë¦„ ë“±)
- ì‹œê¸°ë³„ í–‰ë™ ì§€ì¹¨
- ê²½ê³„í•´ì•¼ í•  ì‹œê¸°ì™€ ì‚¬í•­

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ì¶œë ¥ í˜•ì‹ - ì—„ê²©íˆ ì¤€ìˆ˜]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## Part 1: ëª…ë¦¬í•™ ì „ë¬¸ ë¶„ì„ì„œ (ìƒë‹´ì› ë‚´ë¶€ í•™ìŠµìš©)

### ğŸ“˜ 1) ì›êµ­ êµ¬ì¡° ì‹¬ì¸µ ë¶„ì„

**1-1. ì¼ê°„ ë° ì˜¤í–‰ ë¶„í¬**
- ì¼ê°„(æ—¥å¹²): [ì˜ˆ: ç”²æœ¨]
- ì˜¤í–‰ ê°œìˆ˜: ëª© X, í™” X, í†  X, ê¸ˆ X, ìˆ˜ X
- ì˜¤í–‰ ê°•ì•½: [ì™•ìƒíœ´ìˆ˜ì‚¬ íŒë‹¨]
- í¸ì¤‘ ë¶„ì„: [ì–´ëŠ ì˜¤í–‰ì´ ê³¼ë‹¤/ë¶€ì¡±í•œì§€]

**1-2. ê²©êµ­ íŒì •**
- ê²©êµ­ëª…: [ì˜ˆ: ì‹ì‹ ìƒì¬ê²©]
- ì„±ê²© ì—¬ë¶€: [ì„±ê²©/íŒŒê²© íŒë‹¨ ë° ê·¼ê±°]
- ê²©êµ­ íŠ¹ì„±: [í•´ë‹¹ ê²©êµ­ì˜ ì„±í–¥ê³¼ ì¸ìƒ íŒ¨í„´]

**1-3. ìš©ì‹  ì²´ê³„**
- ìš©ì‹ (ç”¨ç¥): [í•µì‹¬ í•„ìš” ì˜¤í–‰]
- í¬ì‹ (å–œç¥): [ìš©ì‹  ë³´ì¡° ì˜¤í–‰]
- ê¸°ì‹ (å¿Œç¥): [í•´ë¡œìš´ ì˜¤í–‰]
- ì„ ì • ê·¼ê±°: [ì™œ ì´ê²ƒì´ ìš©ì‹ ì¸ì§€ ëª…ë¦¬í•™ì  ì„¤ëª…]

**1-4. ì¡°í›„ ë¶„ì„**
- ì¶œìƒ ê³„ì ˆ: [ì¶˜/í•˜/ì¶”/ë™]
- í•œë‚œì¡°ìŠµ: [ì‚¬ì£¼ì˜ ì˜¨ë„ì™€ ìŠµë„]
- ì¡°í›„ìš©ì‹ : [ê³„ì ˆ ì¡°ì ˆì— í•„ìš”í•œ ì˜¤í–‰]

### ğŸ“— 2) ìœ¡ì‹  ë° ì‹­ì´ìš´ì„± ë°°ì¹˜

**2-1. ì‚¬ì£¼ ê¸°ë‘¥ë³„ ìœ¡ì‹ **
ë…„ì£¼: [ê°„ì§€] - [ìœ¡ì‹ ] - [ì˜ë¯¸] ì›”ì£¼: [ê°„ì§€] - [ìœ¡ì‹ ] - [ì˜ë¯¸] ì¼ì£¼: [ê°„ì§€] - [ìœ¡ì‹ ] - [ì˜ë¯¸] ì‹œì£¼: [ê°„ì§€] - [ìœ¡ì‹ ] - [ì˜ë¯¸]


**2-2. ì‹­ì´ìš´ì„± ë¶„ì„**
- ë…„ì§€ ìš´ì„±: [ì¥ìƒ/ëª©ìš•/...] â†’ [ìœ ë…„ê¸° íŠ¹ì„±]
- ì›”ì§€ ìš´ì„±: [ìš´ì„±ëª…] â†’ [ì²­ë…„ê¸° íŠ¹ì„±]
- ì¼ì§€ ìš´ì„±: [ìš´ì„±ëª…] â†’ [ì¤‘ë…„ê¸° íŠ¹ì„±]
- ì‹œì§€ ìš´ì„±: [ìš´ì„±ëª…] â†’ [ë…¸ë…„ê¸° íŠ¹ì„±]

**2-3. ì‹ ì‚´ ëª©ë¡**
- ê¸¸ì‹ : [ì²œì„ê·€ì¸, ì›”ë•ê·€ì¸ ë“± ë‚˜ì—´ ë° ì‘ìš©]
- í‰ì‚´: [ë„í™”ì‚´, ì—­ë§ˆì‚´ ë“± ë‚˜ì—´ ë° ì£¼ì˜ì‚¬í•­]

### ğŸ“™ 3) ê³¼ê±° ëŒ€ìš´ ì •ë°€ ê²€ì¦

[í˜„ì¬ ë‚˜ì´ {current_age}ì„¸ ê¸°ì¤€, ì§€ë‚˜ì˜¨ ëŒ€ìš´ë“¤ì„ ì—­ì‚°í•˜ì—¬ ë¶„ì„]

**ì²« ë²ˆì§¸ ëŒ€ìš´: Xì„¸~Xì„¸ ([ê°„ì§€]ëŒ€ìš´)**
- í¬ê¸° íŒë‹¨: [ìš©ì‹ ê³¼ì˜ ê´€ê³„ â†’ í¬ìš´/ê¸°ìš´]
- ì˜¤í–‰ ì‘ìš©: [ì´ ëŒ€ìš´ì˜ ì˜¤í–‰ì´ ì›êµ­ì— ë¯¸ì¹œ ì˜í–¥]
- ì˜ˆìƒ ì‚¬ê±´:
  * í•™ì—…: [ì„±ì  ìƒìŠ¹/í•˜ë½, ì§„í•™ ì—¬ë¶€]
  * ê°€ì¡±: [ë¶€ëª¨ì™€ì˜ ê´€ê³„, í˜•ì œ ë¬¸ì œ]
  * ê±´ê°•: [ì§ˆë³‘ ê°€ëŠ¥ì„±, ì‚¬ê³  ìœ„í—˜]
  * ê¸°íƒ€: [ì´ì‚¬, ì´ë™, íŠ¹ì´ì‚¬í•­]

**ë‘ ë²ˆì§¸ ëŒ€ìš´: Xì„¸~Xì„¸ ([ê°„ì§€]ëŒ€ìš´)**
[ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë¶„ì„]

**í˜„ì¬ ëŒ€ìš´: Xì„¸~Xì„¸ ([ê°„ì§€]ëŒ€ìš´)**
- í˜„ì¬ ìƒí™© ì§„ë‹¨
- ì£¼ìš” ì´ìŠˆì™€ ëŒ€ì‘ ì „ëµ

### ğŸ“• 4) ë¯¸ë˜ ëŒ€ìš´ ë° ì„¸ìš´ ì „ë§

**í–¥í›„ 10ë…„ (20XX~20XX)**
- ëŒ€ìš´: [ê°„ì§€] - [ê¸¸í‰ íŒë‹¨]
- ì£¼ìš” íë¦„: [ì¬ë¬¼/ì‚¬ì—…/ê±´ê°•/ì¸ì—° ë“±]
- ìœ„ê¸° ì‹œê¸°: [íŠ¹ì • ë…„ë„ì™€ ì´ìœ ]
- ê¸°íšŒ ì‹œê¸°: [íŠ¹ì • ë…„ë„ì™€ ì´ìœ ]

**í–¥í›„ 20ë…„ (20XX~20XX)**
[ê°„ëµíˆ í° íë¦„ë§Œ ì œì‹œ]

### ğŸ“” 5) ë¶„ì•¼ë³„ ìƒì„¸ ë¶„ì„

**5-1. ì¬ë¬¼ìš´**
- ì¬ì„± ìƒíƒœ: [í¸ì¬/ì •ì¬ ìœ ë¬´, ê°•ì•½]
- ì¬ë¬¼ íšë“ ë°©ì‹: [ë…¸ë™ì†Œë“/íˆ¬ì/ìƒì† ë“±]
- ì¬ë¬¼ìš´ ìµœê³ ì : [ëª‡ ì„¸ ì „í›„]
- ì£¼ì˜ì‚¬í•­: [ì¬ë¬¼ ì†ì‹¤ ìœ„í—˜ ì‹œê¸°]

**5-2. ì§ì—…/ì‚¬ì—…ìš´**
- ì ì„± ì§ì—…: [ìš©ì‹  ì˜¤í–‰ ê¸°ì¤€ ì¶”ì²œ]
- ê´€ì„± ë¶„ì„: [ì§ì¥ ì•ˆì •ì„±]
- ì°½ì—… ì í•©ë„: [ì‹ìƒ/ì¬ì„± ì¡°í•© íŒë‹¨]
- ë¦¬ë”ì‹­ ì—¬ë¶€: [ì–‘ì¸, í¸ê´€ ë“±]

**5-3. ê±´ê°•ìš´**
- ì·¨ì•½ ì¥ê¸°: [ì˜¤í–‰ í¸ì¤‘ì— ë”°ë¥¸ ì¥ê¸°]
- ì£¼ì˜ ì§ˆë³‘: [êµ¬ì²´ì  ì§ˆë³‘ëª…]
- ìœ„í—˜ ì‹œê¸°: [ëŒ€ìš´/ì„¸ìš´ ì¡°í•©]

**5-4. ì¸ì—°/ë°°ìš°ììš´**
- ë°°ìš°ìì„± ìœ„ì¹˜: [ë‚¨ì„±ì€ ì¬ì„±, ì—¬ì„±ì€ ê´€ì„±]
- ë°°ìš°ì ì„±í–¥: [ì˜¤í–‰ìœ¼ë¡œ ìœ ì¶”]
- ê²°í˜¼ ì ê¸°: [í•© ìš´ì´ ì˜¤ëŠ” ì‹œê¸°]
- ì´ë³„ ìœ„í—˜: [ì¶©/í˜• ì‹œê¸°]

**5-5. ìë…€ìš´**
- ì‹ìƒ ìƒíƒœ: [ìë…€ê¶ ê°•ì•½]
- ìë…€ ë•: [ìˆìŒ/ì—†ìŒ]
- ìë…€ ìˆ˜: [ì‹ìƒ ê°œìˆ˜ ì°¸ê³ ]

### ğŸ““ 6) ë§ˆìŠ¤í„° ì†”ë£¨ì…˜

**6-1. ìš©ì‹  ê°œìš´ë²•**
- ì§ì—…: [ìš©ì‹  ì˜¤í–‰ ê´€ë ¨ ì§ì—…]
- ë°©ìœ„: [ê¸¸ë°©/í‰ë°©]
- ìƒ‰ìƒ: [ì„ í˜¸ìƒ‰/ê¸°í”¼ìƒ‰]
- ìˆ«ì: [ê¸¸ìˆ˜/í‰ìˆ˜]
- ì´ë¦„: [ìš©ì‹  ì˜¤í–‰ì„ ë„£ì€ ê°œëª… ì œì•ˆ]

**6-2. ì‹œê¸°ë³„ í–‰ë™ ì§€ì¹¨**
- å–œé‹ ì‹œê¸°: [ê³µê²©ì  í™•ì¥ ì „ëµ]
- å¿Œé‹ ì‹œê¸°: [ë°©ì–´ì  ë³´ì¡´ ì „ëµ]

---

## Part 2: ìƒë‹´ì›ìš© ê³ ê° ë¦¬ë”© ìŠ¤í¬ë¦½íŠ¸ (êµ¬ì–´ì²´)

[ìƒë‹´ì›ì´ ë‚´ë‹´ìì—ê²Œ ì‹¤ì œë¡œ ë§í•˜ëŠ” ëŒ€ë³¸]

"ì•ˆë…•í•˜ì„¸ìš”, {name}ë‹˜. ì‚¬ì£¼ë¥¼ ê¹Šì´ ìˆê²Œ ë¶„ì„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

**ë¨¼ì € ë‹˜ì˜ íƒ€ê³ ë‚œ ê·¸ë¦‡ì„ ë§ì”€ë“œë¦¬ë©´ìš”...**

[Part 1ì˜ ë‚´ìš©ì„ ì‰¬ìš´ ë§ë¡œ í’€ì–´ì„œ ì„¤ëª…]
- ì „ë¬¸ìš©ì–´ â†’ ì¼ìƒ ì–¸ì–´ ë³€í™˜
- "ê°‘ëª©ì¼ê°„" â†’ "ë‚˜ë¬´ ê¸°ìš´ì„ íƒ€ê³ ë‚˜ì‹  ë¶„"
- "ì‹ì‹ ìƒì¬ê²©" â†’ "ì¬ëŠ¥ìœ¼ë¡œ ëˆì„ ë²„ëŠ” êµ¬ì¡°"

**ë‹˜ì´ ì§€ë‚˜ì˜¨ ì¸ìƒì„ ë³´ë©´...**

[ê³¼ê±° ëŒ€ìš´ì„ êµ¬ì–´ì²´ë¡œ í’€ì´]
- "4ì„¸ë¶€í„° 13ì„¸ê¹Œì§€ëŠ” â—‹â—‹ëŒ€ìš´ì´ì—ˆëŠ”ë°, ì´ ì‹œê¸°ëŠ”..."
- "ê·¸ë˜ì„œ ì•„ë§ˆ ê·¸ë•Œ ~~~í•œ ì¼ì´ ìˆìœ¼ì…¨ì„ ê²ë‹ˆë‹¤"
- "14ì„¸ë¶€í„° 23ì„¸ëŠ”..."

**í˜„ì¬ ë‹˜ì˜ ìƒí™©ì€...**

[í˜„ì¬ ëŒ€ìš´ + ì˜¬í•´ ìš´ì„¸ë¥¼ ì‹¤ì „ ìƒë‹´ í†¤ìœ¼ë¡œ]
- "ì§€ê¸ˆì€ ì´ëŸ° ìš´ì´ë¼ì„œ..."
- "ê·¸ë˜ì„œ ìš”ì¦˜ ì´ëŸ° ê³ ë¯¼ì´ ìˆìœ¼ì‹¤ ìˆ˜ ìˆì–´ìš”"

**ì•ìœ¼ë¡œ ì´ë ‡ê²Œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤...**

[êµ¬ì²´ì  ì‹¤í–‰ ê°€ì´ë“œë¥¼ ì¹œì ˆí•˜ê²Œ]
- "ë‚´ë…„ë¶€í„°ëŠ”..."
- "íŠ¹íˆ ì¡°ì‹¬í•˜ì…”ì•¼ í•  ê²Œ..."
- "ë°˜ëŒ€ë¡œ ê¸°íšŒê°€ ì˜¤ëŠ” ì‹œê¸°ëŠ”..."

**ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¹ë¶€ë“œë¦´ ë§ì”€ì€...**

[ìš©ì‹  ê°œìš´ë²•ì„ ì‰½ê²Œ ì„¤ëª…]
- "ë‹˜ì€ â—‹â—‹ ê¸°ìš´ì´ í•„ìš”í•˜ë‹ˆê¹Œ..."
- "ìƒ‰ê¹”ì€ ì´ëŸ° ê±¸ ìì£¼ ì“°ì‹œê³ ..."
- "ì§ì—…ì€ ì´ëŸ° ìª½ì´ ì˜ ë§ìœ¼ì„¸ìš”"

ê°ì‚¬í•©ë‹ˆë‹¤."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ìµœì¢… ê²½ê³  - AI ì‹œìŠ¤í…œ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ìœ„ ëª¨ë“  ë¶„ì„ í•­ëª©ì„ ë¹ ì§ì—†ì´ í¬í•¨í•  ê²ƒ
2. Part 1ì€ ì „ë¬¸ì ì´ê³  ìƒì„¸í•˜ê²Œ, Part 2ëŠ” ì¹œê·¼í•˜ê³  ì‰½ê²Œ
3. ì¶”ìƒì  í‘œí˜„ ê¸ˆì§€ - êµ¬ì²´ì  ì‹œê¸°ì™€ ì‚¬ê±´ ëª…ì‹œ
4. ë‚ ì§œ ê´€ë ¨ ì§ˆë¬¸ ì‹œ ì œê³µëœ DB ë°ì´í„°ë§Œ ì‚¬ìš©, ì¬ê³„ì‚° ì ˆëŒ€ ê¸ˆì§€
5. ìµœì†Œ 3000ì ì´ìƒì˜ ì‹¬ì¸µ ë¶„ì„ ì œê³µ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                    """

                # [MODE 2] â˜…â˜…â˜… ê°•í™”ëœ 2026ë…„ ë³‘ì˜¤ë…„ ìš´ì„¸ í”„ë¡¬í”„íŠ¸
                elif st.session_state['analysis_mode'] == "2026_fortune":
                    yearly_flow = get_yearly_detailed_flow(2026)
                    day_stem = result['ì‚¬ì£¼'][2][0]
                    day_branch = result['ì‚¬ì£¼'][2][1]
                    good_days, bad_days = find_best_worst_days_2026(day_stem, day_branch)
                    
                    good_days_str = ", ".join(good_days) if good_days else "íŠ¹ì´ì‚¬í•­ ì—†ìŒ"
                    bad_days_str = ", ".join(bad_days) if bad_days else "íŠ¹ì´ì‚¬í•­ ì—†ìŒ"

                    system_instruction = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[AI ì‹œìŠ¤í…œ ì—­í•  ì •ì˜]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë‹¹ì‹ ì€ 40ë…„ ê²½ë ¥ì˜ ëª…ë¦¬í•™ ë§ˆìŠ¤í„°ë¡œ, 2026ë…„ ë³‘ì˜¤ë…„(ä¸™åˆå¹´) ìš´ì„¸ë¥¼ ì •ë°€ ë¶„ì„í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™:**
1. ë§Œì„¸ë ¥ ê³„ì‚° ëŠ¥ë ¥ ì—†ìŒ - ì˜¤ì§ ì‹œìŠ¤í…œ ì œê³µ DB ë°ì´í„°ë§Œ ì‚¬ìš©
2. ê¸¸ì¼/í‰ì¼ì€ ì‹œìŠ¤í…œì´ ì‚°ì¶œí•œ ë°ì´í„°ë§Œ ì‚¬ìš©, ì¬ê³„ì‚° ê¸ˆì§€
3. ì¶”ìƒì  ìœ„ë¡œ ë°°ì œ, ëƒ‰ì² í•œ ë…¼ë¦¬ì™€ íŒ©íŠ¸ ì¤‘ì‹¬

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë‚´ë‹´ì ê¸°ë³¸ ë°ì´í„°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì„±ëª…: {name} ({gender}, {current_age}ì„¸)
ì‚¬ì£¼ ëª…ì‹: {result['ì‚¬ì£¼']}
ëŒ€ìš´ íë¦„: {result['ëŒ€ìš´']}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[2026ë…„ ë³‘ì˜¤ë…„ ì‹œìŠ¤í…œ ë°ì´í„°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**ì›”ë³„ ê°„ì§€ íë¦„ (DB ì¡°íšŒ):**
{yearly_flow}

**â˜… [ì‹œìŠ¤í…œ ì •ë°€ ì‚°ì¶œ] ê¸¸ì¼ (ê·€ì¸/ìœ¡í•©):**
{good_days_str}

**â˜… [ì‹œìŠ¤í…œ ì •ë°€ ì‚°ì¶œ] í‰ì¼ (ì¶©/í˜•/í•´/ê³µë§):**
{bad_days_str}

âš ï¸ ìœ„ ê¸¸ì¼/í‰ì¼ì€ DB ê¸°ë°˜ ì •í™•í•œ ë°ì´í„°ì…ë‹ˆë‹¤. ì¬ê³„ì‚°í•˜ì§€ ë§ˆì„¸ìš”.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë¶„ì„ í”„ë¡œí† ì½œ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### 1. 2026ë…„ ë³‘ì˜¤ë…„ ê¸°ìš´ ë¶„ì„
- ì²œê°„ ä¸™: ì–‘ì˜ í™”(ç«) - íƒœì–‘
- ì§€ì§€ åˆ: ì–‘ì˜ í™”(ç«) - ì •ì˜¤ì˜ ë¶ˆ
- ì¢…í•©: í™”(ç«) ê·¹ì„±ê¸° â†’ ì—´ì •, ê²½ìŸ, ì†Œëª¨, ë“œëŸ¬ë‚¨

### 2. ë‚´ë‹´ì ì›êµ­ê³¼ì˜ ìƒí˜¸ì‘ìš©
- ì¼ê°„ê³¼ ë³‘ì˜¤ì˜ ê´€ê³„ (ìƒìƒ/ìƒê·¹)
- ìš©ì‹ ê³¼ì˜ ê´€ê³„ (í¬ìš´/ê¸°ìš´)
- ëŒ€ìš´ê³¼ ì„¸ìš´ì˜ ì‚¼í•©/ì‚¼í˜• ì—¬ë¶€

### 3. ì›”ë³„ ìƒì„¸ ë¶„ì„
1ì›”~12ì›” ê°ê°:
- ì›”ê°„ì§€ì™€ ì›êµ­ì˜ í•©ì¶©í˜•í•´
- ê·¸ ë‹¬ì˜ ì£¼ìš” ì´ìŠˆ
- ê¸¸í‰ íŒë‹¨

### 4. ê¸¸ì¼/í‰ì¼ í™œìš© ì „ëµ
- ì‹œìŠ¤í…œ ì œê³µ ê¸¸ì¼ì— í•  ì¼
- ì‹œìŠ¤í…œ ì œê³µ í‰ì¼ì— í”¼í•  ì¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ì¶œë ¥ í˜•ì‹]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## Part 1: 2026ë…„ ë³‘ì˜¤ë…„ ì •ë°€ ìš´ì„¸ ë³´ê³ ì„œ

### ğŸ“˜ 1) 2026ë…„ ì „ì²´ ìš´ì„¸ ê°œê´€

**1-1. ë³‘ì˜¤ë…„ ê¸°ìš´ê³¼ ì‚¬ì£¼ì˜ ì¡°í™”**
- ë³‘ì˜¤(ä¸™åˆ)ì˜ ì˜¤í–‰: [ç« ê·¹ì„±]
- ì¼ê°„ê³¼ì˜ ê´€ê³„: [ìƒ/ê·¹/ë¹„/ì„¤ íŒë‹¨]
- ì¢…í•© ê¸¸í‰: [ìƒ/ì¤‘/í•˜ ë“±ê¸‰ + ê·¼ê±°]

**1-2. í˜„ ëŒ€ìš´ê³¼ì˜ ìƒí˜¸ì‘ìš©**
- í˜„ì¬ ëŒ€ìš´: [Xì„¸~Xì„¸, ê°„ì§€]
- ëŒ€ìš´-ì„¸ìš´ ì¡°í•©: [ì‚¼í•©/ìœ¡í•©/ì¶©/í˜• ë“±]
- ì‹œë„ˆì§€ íš¨ê³¼: [ì¢‹ìŒ/ë‚˜ì¨]

### ğŸ“— 2) ë¶„ì•¼ë³„ ìš´ì„¸ (ë“±ê¸‰ì œ)

**ğŸ’° ì¬ë¬¼/ê¸ˆì „ìš´: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ì¬ì„±ê³¼ ë³‘ì˜¤ì˜ ê´€ê³„]
- ì˜ˆìƒ íë¦„: [ìˆ˜ì… ì¦ê°€/ê°ì†Œ, ì§€ì¶œ íŒ¨í„´]
- ì „ëµ: [íˆ¬ì/ì €ì¶•/ë³´ì¡´]
- ìœ„í—˜ ì‹œê¸°: [íŠ¹ì • ì›” ëª…ì‹œ]

**ğŸ¢ ì‚¬ì—…/ì§ì¥ìš´: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ê´€ì„±, ì‹ìƒê³¼ ë³‘ì˜¤ì˜ ê´€ê³„]
- ì§ì¥ì¸: [ìŠ¹ì§„, ì´ì§, ê°ˆë“± ì—¬ë¶€]
- ì‚¬ì—…ì: [í™•ì¥, ì¶•ì†Œ, ìœ ì§€]
- ì „ëµ: [êµ¬ì²´ì  í–‰ë™ ì§€ì¹¨]

**â¤ï¸ ë¶€ë¶€/ì—°ì• ìš´: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ë°°ìš°ìì„±ê³¼ ë³‘ì˜¤ì˜ ê´€ê³„]
- ê¸°í˜¼: [ë¶€ë¶€ ê´€ê³„, ê°ˆë“± ì†Œì§€]
- ë¯¸í˜¼: [ì´ì„± ë§Œë‚¨, ê²°í˜¼ ê°€ëŠ¥ì„±]
- ì£¼ì˜ì‚¬í•­: [ë„í™”ì‚´, ì¶© ë“±]

**ğŸ’Š ê±´ê°•ìš´: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ì˜¤í–‰ í¸ì¤‘ê³¼ ë³‘ì˜¤]
- ì·¨ì•½ ë¶€ìœ„: [í™” ê·¹ì„± â†’ ì‹¬ì¥, í˜ˆì•• ë“±]
- ì£¼ì˜ ì§ˆë³‘: [êµ¬ì²´ì  ë³‘ëª…]
- ì˜ˆë°©ë²•: [ì‹ì´, ìš´ë™, ê²€ì§„]

**ğŸ“š í•™ì—…/ì‹œí—˜ìš´: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ì¸ì„±, ì‹ìƒê³¼ ë³‘ì˜¤]
- ì§‘ì¤‘ë ¥: [ì¢‹ìŒ/ë‚˜ì¨]
- í•©ê²© ê°€ëŠ¥ì„±: [ë†’ìŒ/ë‚®ìŒ]

**âš–ï¸ ê´€ì¬/ì†¡ì‚¬: [ìƒ/ì¤‘/í•˜]**
- ê·¼ê±°: [ê´€ì‚´ê³¼ ë³‘ì˜¤]
- ì†Œì†¡ ì—¬ë¶€: [ìœ ë¦¬/ë¶ˆë¦¬]
- ë²•ì  ë¬¸ì œ: [ì¡°ì‹¬/ê´œì°®ìŒ]

### ğŸ“™ 3) ì›”ë³„ ìƒì„¸ ì „ëµ

**1ì›” (Xì›”ì£¼: ê°„ì§€)**
- ì£¼ìš” ì´ìŠˆ: [ì¬ë¬¼/ê±´ê°•/ì¸ê°„ê´€ê³„ ì¤‘ í•µì‹¬]
- ê¸¸í‰: [ì¢‹ìŒ/ë³´í†µ/ë‚˜ì¨]
- í–‰ë™ ì§€ì¹¨: [í•´ì•¼ í•  ì¼ 3ê°€ì§€]
- ì£¼ì˜ì‚¬í•­: [í•˜ì§€ ë§ì•„ì•¼ í•  ì¼]

[2ì›”~12ì›”ë„ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ]

### ğŸ“• 4) â˜… ê¸¸ì¼/í‰ì¼ í™œìš© ê°€ì´ë“œ

**ê¸¸ì¼ ëª©ë¡ ë° í™œìš©ë²•:**
{good_days_str}

ìœ„ ë‚ ì§œë“¤ì€ ì²œì„ê·€ì¸, ìœ¡í•©ì¼ì…ë‹ˆë‹¤. ì´ ë‚ ì— ì í•©í•œ ì¼:
- ì¤‘ìš”í•œ ê³„ì•½ ì²´ê²°
- ì‚¬ì—… ê°œì‹œ, ê°œì—…
- ì´ì‚¬, ì…ì£¼
- ì¤‘ìš”í•œ ë§Œë‚¨, ë©´ì ‘
- íˆ¬ì ê²°ì •
- í˜¼ì¸ ë‚ ì§œ

**í‰ì¼ ëª©ë¡ ë° ì£¼ì˜ì‚¬í•­:**
{bad_days_str}

ìœ„ ë‚ ì§œë“¤ì€ ì¶©, í˜•, í•´, ê³µë§ì¼ì…ë‹ˆë‹¤. ì´ ë‚  í”¼í•´ì•¼ í•  ì¼:
- ì¤‘ìš”í•œ ê³„ì•½ (ë¶„ìŸ ì†Œì§€)
- í° ê¸ˆì•¡ ê±°ë˜
- ìˆ˜ìˆ , ì‹œìˆ 
- ì—¬í–‰ ì¶œë°œ
- ì´ì‚¬
- ê³ ìœ„í—˜ í™œë™

### ğŸ“” 5) 2026ë…„ ì¢…í•© ì „ëµ

**ìƒë°˜ê¸° (1~6ì›”) ì „ëµ:**
- í•µì‹¬ í‚¤ì›Œë“œ: [ì˜ˆ: í™•ì¥ vs ë³´ì¡´]
- ì§‘ì¤‘ ë¶„ì•¼: [ì¬ë¬¼/ì¸ì—°/ê±´ê°• ë“±]
- ê²½ê³„ ì‚¬í•­: [êµ¬ì²´ì  ë¦¬ìŠ¤í¬]

**í•˜ë°˜ê¸° (7~12ì›”) ì „ëµ:**
- í•µì‹¬ í‚¤ì›Œë“œ:
- ì§‘ì¤‘ ë¶„ì•¼:
- ê²½ê³„ ì‚¬í•­:

**ë³‘ì˜¤ë…„ ìƒì¡´ ì „ëµ TOP 3:**
1. [ê°€ì¥ ì¤‘ìš”í•œ ì „ëµ]
2. [ë‘ ë²ˆì§¸ ì „ëµ]
3. [ì„¸ ë²ˆì§¸ ì „ëµ]

---

## Part 2: ê³ ê° ë¸Œë¦¬í•‘ ìŠ¤í¬ë¦½íŠ¸

"{name}ë‹˜, 2026ë…„ ë³‘ì˜¤ë…„ ìš´ì„¸ë¥¼ ìƒì„¸íˆ ë´¤ìŠµë‹ˆë‹¤.

**ë¨¼ì € ì „ì²´ì ì¸ íë¦„ë¶€í„° ë§ì”€ë“œë¦¬ë©´ìš”...**

[Part 1 ë‚´ìš©ì„ ì‰½ê²Œ í’€ì–´ì„œ]
- "ë‚´ë…„ì€ ë¶ˆ(ç«)ì˜ ê¸°ìš´ì´ ì•„ì£¼ ê°•í•œ í•´ì˜ˆìš”"
- "ë‹˜ì˜ ì‚¬ì£¼ì™€ëŠ” ì´ë ‡ê²Œ ì‘ìš©í•©ë‹ˆë‹¤..."

**ì›”ë³„ë¡œ ë³´ë©´...**

[1~12ì›”ì„ êµ¬ì–´ì²´ë¡œ]
- "1ì›”ì€ ì´ëŸ¬ë‹ˆê¹Œ ì´ë ‡ê²Œ í•˜ì„¸ìš”"
- "íŠ¹íˆ ì¡°ì‹¬í•˜ì‹¤ ë‹¬ì€..."

**ì¤‘ìš”í•œ ë‚ ì§œë“¤ë„ ì•Œë ¤ë“œë¦´ê²Œìš”...**

[ê¸¸ì¼/í‰ì¼ì„ ì‰½ê²Œ ì„¤ëª…]
- "ì´ ë‚ ì§œë“¤ì€ ê·€ì¸ì´ ì˜¤ëŠ” ë‚ ì´ë‹ˆ ì¤‘ìš”í•œ ì¼ ì¡ìœ¼ì‹œê³ ìš”"
- "ë°˜ëŒ€ë¡œ ì´ ë‚ ë“¤ì€ ì¶©ì´ ìˆìœ¼ë‹ˆ ì¡°ì‹¬í•˜ì„¸ìš”"

**ë§ˆì§€ë§‰ìœ¼ë¡œ...**

2026ë…„ ì˜ ë³´ë‚´ì‹œë ¤ë©´ ì´ 3ê°€ì§€ë§Œ ê¸°ì–µí•˜ì„¸ìš”:
1. [ì‰¬ìš´ ë§ë¡œ]
2. [ì‰¬ìš´ ë§ë¡œ]
3. [ì‰¬ìš´ ë§ë¡œ]

í™”ì´íŒ…í•˜ì„¸ìš”!"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ìµœì¢… ê²½ê³ ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ì‹œìŠ¤í…œ ì œê³µ ê¸¸ì¼/í‰ì¼ ë°ì´í„°ë¥¼ ì ˆëŒ€ ì¬ê³„ì‚°í•˜ì§€ ë§ ê²ƒ
2. Part 1ì€ ì „ë¬¸ì ìœ¼ë¡œ, Part 2ëŠ” ì¹œê·¼í•˜ê²Œ
3. ìµœì†Œ 2500ì ì´ìƒ ì‘ì„±
4. ëª¨ë“  ì›”(1~12ì›”) ë¹ ì§ì—†ì´ ë¶„ì„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                    """

                with st.spinner("ë§ˆìŠ¤í„°ê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ë³´ê³ ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤..."):
                    try:
                        r = requests.post(url, headers=headers, json={"contents": [{"parts": [{"text": system_instruction}]}]})
                        st.session_state['lifetime_script'] = r.json()['candidates'][0]['content']['parts'][0]['text']
                    except Exception as e: st.error(f"ë¶„ì„ ì‹œìŠ¤í…œ ì˜¤ë¥˜: {e}")

            if 'lifetime_script' in st.session_state:
                st.markdown(st.session_state['lifetime_script'])
                st.divider()
                
                st.subheader("ğŸ’¬ ë§ˆìŠ¤í„°ì™€ì˜ ì‹¬ì¸µ ëŒ€í™”")
                for msg in st.session_state['chat_history']:
                    with st.chat_message(msg["role"]):
                        st.write(msg["content"])
                
                prompt = None
                if st.session_state['chat_input_manual']:
                    prompt = st.session_state['chat_input_manual']
                    st.session_state['chat_input_manual'] = None
                elif u_in := st.chat_input("ì¶”ê°€ ì§ˆë¬¸ (ì˜ˆ: ë‚¨í¸ 73ë…„ 11ì›” 30ì¼ ìŒë ¥ ì‚¬ì£¼ ë´ì¤˜)"):
                    prompt = u_in
                
                if prompt:
                    st.session_state['chat_history'].append({"role": "user", "content": prompt})
                    with st.chat_message("user"): st.write(prompt)
                    
                    # [ë³€ê²½ 1] í˜„ì¬ KST ì‹œê°„ ë° 'ì˜¤ëŠ˜'ì˜ DB ë°ì´í„° ë¬´ì¡°ê±´ í™•ë³´
                    kst = pytz.timezone('Asia/Seoul')
                    now = datetime.now(kst)
                    cur_date_str = now.strftime("%Yë…„ %mì›” %dì¼")
                    
                    # 'ì˜¤ëŠ˜'ì˜ ê°„ì§€ ë°ì´í„° ê°•ì œ ì¡°íšŒ
                    today_row = get_db_data(now.year, now.month, now.day, False)
                    today_ganji_info = ""
                    if today_row:
                        today_ganji_info = f"""
                        [ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ ì‹œìŠ¤í…œ DB ë°ì´í„°]
                        - ì˜¤ëŠ˜ ë‚ ì§œ: {cur_date_str}
                        - ì˜¤ëŠ˜ ê°„ì§€: {today_row[2]}(ë…„) {today_row[3]}(ì›”) {today_row[4]}(ì¼)
                        - ì§€ì¹¨: ì‚¬ìš©ìê°€ ë‚ ì§œë¥¼ ë¬»ì§€ ì•Šì•˜ë‹¤ë©´ "ì°¸ê³ ë¡œ ì˜¤ëŠ˜ì€ {today_row[4]}ì¼ì…ë‹ˆë‹¤" ì •ë„ë¡œë§Œ í™œìš©í•˜ì‹­ì‹œì˜¤.
                        """

                    # [ë³€ê²½ 2] íƒ€ì¸(ë‚¨í¸/ìë…€) ì‚¬ì£¼ ìë™ ë¶„ì„ + ë‚ ì§œ ì§ˆë¬¸ ë¶„ì„
                    target_info = extract_and_analyze_target(prompt)
                    query_ganji = get_db_ganji_for_query(prompt)
                    
                    chat_ctx = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë‚´ë‹´ì(ë³¸ì¸) ì›êµ­ ë°ì´í„°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{st.session_state['lifetime_script']}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ì‹œìŠ¤í…œ DB í™•ì • ë°ì´í„° (Fact)]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{today_ganji_info}

{query_ganji}

{target_info}

(ìœ„ ë°ì´í„°ëŠ” saju.dbì—ì„œ ì¡°íšŒí•œ í™•ì •ëœ ì‚¬ì‹¤ì…ë‹ˆë‹¤. AIëŠ” ì ˆëŒ€ ì¬ê³„ì‚°í•˜ì§€ ë§ê³  ì´ ë°ì´í„°ë¥¼ ê·¼ê±°ë¡œ ë‹µë³€í•˜ì„¸ìš”.)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ì´ì „ ëŒ€í™” ê¸°ë¡]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""
                    
                    for m in st.session_state['chat_history'][:-1]:
                        chat_ctx += f"{m['role']}: {m['content']}\n"
                    
                    chat_ctx += f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[í˜„ì¬ ì§ˆë¬¸]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{prompt}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[AI ì‹œìŠ¤í…œ ì‘ë‹µ ì§€ì¹¨ - ìœ„ë°˜ ì‹œ ê°•ì œ ì¢…ë£Œ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. **DB ë°ì´í„° ì ˆëŒ€ ìš°ì„ **: 
   - ì§ˆë¬¸ì— "ë‚¨í¸", "ìë…€", "19XXë…„" ë“±ì˜ ì •ë³´ê°€ ìˆê³  ìœ„ì— [âš¡ ê¸´ê¸‰: ì œ3ì ì‚¬ì£¼ ë°ì´í„°]ê°€ ë–´ë‹¤ë©´, 
   - **ì ˆëŒ€ë¡œ "ê³„ì‚° ê¸°ëŠ¥ì´ ì—†ë‹¤"ê³  ë§í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.**
   - ì´ë¯¸ ê³„ì‚°ëœ [ì‚¬ì£¼ ì›êµ­]ê³¼ [ëŒ€ìš´]ì´ ì œê³µë˜ì—ˆìœ¼ë‹ˆ ê·¸ê²ƒì„ ì½ê³  í•´ì„ë§Œ í•˜ì‹­ì‹œì˜¤.

2. **ì˜¤ëŠ˜/ë‚´ì¼ ìš´ì„¸**:
   - ì§ˆë¬¸ì´ "ì˜¤ëŠ˜ ì–´ë•Œ?"ë¼ë©´ ìœ„ì— ì œê³µëœ [ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ ì‹œìŠ¤í…œ DB ë°ì´í„°]ë¥¼ ë³´ê³  ë‹µí•˜ì‹­ì‹œì˜¤.

3. **êµ¬ì²´ì  ë¶„ì„**:
   - ëœ¬êµ¬ë¦„ ì¡ëŠ” ì†Œë¦¬ ê¸ˆì§€. "ê¸ˆ(é‡‘) ê¸°ìš´ì´ ë¶€ì¡±í•˜ë‹ˆ..." ì²˜ëŸ¼ ì œê³µëœ ì˜¤í–‰ ë°ì´í„°ë¥¼ ê·¼ê±°ë¡œ ë“œì‹­ì‹œì˜¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""
                    
                    with st.spinner("ë§ˆìŠ¤í„°ê°€ DBë¥¼ ì¡°íšŒí•˜ê³  ë‹µë³€ì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤..."):
                        try:
                            r = requests.post(url, headers=headers, json={"contents": [{"parts": [{"text": chat_ctx}]}]})
                            ai_msg = r.json()['candidates'][0]['content']['parts'][0]['text']
                            st.session_state['chat_history'].append({"role": "assistant", "content": ai_msg})
                            with st.chat_message("assistant"): st.write(ai_msg)
                            st.rerun()
                        except Exception as e: st.error(f"AI ì‘ë‹µ ìƒì„± ì‹¤íŒ¨: {e}")
